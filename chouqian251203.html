<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随机抽签工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .description {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 176, 155, 0.4);
            margin: 0 0.5rem 0.5rem;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 176, 155, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-stop {
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            box-shadow: 0 4px 15px rgba(255, 75, 43, 0.4);
        }
        
        .btn-stop:hover {
            box-shadow: 0 6px 20px rgba(255, 75, 43, 0.6);
        }
        
        .btn-reset {
            background: linear-gradient(45deg, #8e2de2, #4a00e0);
            box-shadow: 0 4px 15px rgba(142, 45, 226, 0.4);
        }
        
        .btn-reset:hover {
            box-shadow: 0 6px 20px rgba(142, 45, 226, 0.6);
        }
        
        .btn-settings {
            background: linear-gradient(45deg, #ff9f43, #ff3c00);
            box-shadow: 0 4px 15px rgba(255, 159, 67, 0.4);
        }
        
        .btn-settings:hover {
            box-shadow: 0 6px 20px rgba(255, 159, 67, 0.6);
        }
        
        .result-area {
            margin: 2rem 0;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .current-result {
            font-size: 5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .numbers-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
            max-width: 800px;
        }
        
        .number {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }
        
        .number:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.3);
        }
        
        .number.selected {
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(255, 75, 43, 0.4);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 2rem;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            text-align: center;
        }
        
        .modal h2 {
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 1rem;
            border-radius: 10px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 1.5rem;
        }
        
        textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }
        
        .counter {
            margin-top: 1rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .status {
            margin-top: 1rem;
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .result-number {
            font-size: 4rem;
            font-weight: 700;
            margin: 1rem 0;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .result-text {
            font-size: 1.5rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            word-break: break-word;
        }
        
        .settings-options {
            margin: 1.5rem 0;
            text-align: left;
        }
        
        .settings-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
            padding: 0.5rem;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.08);
            transition: background 0.3s ease;
        }
        
        .settings-option:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .settings-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 1rem;
            accent-color: #FF4B2B;
            cursor: pointer;
        }
        
        .settings-option label {
            flex: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .settings-option .option-text {
            margin-left: 0.5rem;
            opacity: 0.9;
        }
        
        .batch-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 0.5s infinite;
        }
        
        @media (max-width: 600px) {
            .number {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            
            .current-result {
                font-size: 4rem;
            }
            
            .btn {
                padding: 0.7rem 1.2rem;
                margin: 0.3rem;
            }
            
            .settings-option {
                flex-direction: row;
                align-items: center;
            }
            
            .settings-option .option-text {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>随机抽签工具</h1>
        <p class="description">输入您的选项，点击开始按钮进行随机抽签，已选中的选项将不再参与后续抽签</p>
        
        <div class="control-panel">
            <button class="btn" id="inputBtn">输入选项</button>
            <button class="btn" id="drawBtn">开始抽签</button>
            <button class="btn btn-settings" id="settingsBtn">设置选项状态</button>
            <button class="btn btn-reset" id="resetBtn">重置</button>
        </div>
        
        <div class="result-area">
            <div class="current-result" id="currentResult">-</div>
            <div class="status" id="status">准备开始抽签</div>
        </div>
        
        <div class="numbers-container" id="numbersContainer">
            <!-- 数字将通过JavaScript动态生成 -->
        </div>
        
        <div class="counter" id="counter">总选项: 0 | 已选: 0 | 剩余: 0</div>
    </div>
    
    <!-- 输入选项对话框 -->
    <div class="modal" id="inputModal">
        <div class="modal-content">
            <h2>输入选项内容</h2>
            <textarea id="optionsInput" placeholder="请输入选项内容，每行一个选项，最多20个选项&#10;例如：&#10;选项一&#10;选项二&#10;选项三"></textarea>
            <div class="modal-buttons">
                <button class="btn" id="confirmBtn">确认</button>
                <button class="btn btn-reset" id="cancelBtn">取消</button>
            </div>
            <div class="counter">当前行数: <span id="lineCount">0</span>/20</div>
        </div>
    </div>
    
    <!-- 结果显示对话框 -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2>抽签结果</h2>
            <div class="result-number" id="resultNumber">-</div>
            <div class="result-text" id="resultText"></div>
            <div class="modal-buttons">
                <button class="btn" id="closeResultBtn">关闭</button>
            </div>
        </div>
    </div>
    
    <!-- 选项状态设置对话框 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h2>设置选项状态</h2>
            <p class="description" style="margin-bottom: 1rem; font-size: 1rem;">勾选表示标记为已选，未勾选表示未选</p>
            
            <div class="batch-actions">
                <button class="btn" id="selectAllBtn">全选</button>
                <button class="btn" id="deselectAllBtn">全不选</button>
                <button class="btn" id="invertSelectionBtn">反选</button>
            </div>
            
            <div class="settings-options" id="settingsOptionsContainer">
                <!-- 选项状态设置项将通过JavaScript动态生成 -->
            </div>
            
            <div class="modal-buttons">
                <button class="btn" id="saveSettingsBtn">保存设置</button>
                <button class="btn btn-reset" id="cancelSettingsBtn">取消</button>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const inputBtn = document.getElementById('inputBtn');
            const drawBtn = document.getElementById('drawBtn');
            const resetBtn = document.getElementById('resetBtn');
            const settingsBtn = document.getElementById('settingsBtn');
            const currentResult = document.getElementById('currentResult');
            const numbersContainer = document.getElementById('numbersContainer');
            const counter = document.getElementById('counter');
            const status = document.getElementById('status');
            const inputModal = document.getElementById('inputModal');
            const optionsInput = document.getElementById('optionsInput');
            const confirmBtn = document.getElementById('confirmBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const lineCount = document.getElementById('lineCount');
            const resultModal = document.getElementById('resultModal');
            const resultNumber = document.getElementById('resultNumber');
            const resultText = document.getElementById('resultText');
            const closeResultBtn = document.getElementById('closeResultBtn');
            const settingsModal = document.getElementById('settingsModal');
            const settingsOptionsContainer = document.getElementById('settingsOptionsContainer');
            const selectAllBtn = document.getElementById('selectAllBtn');
            const deselectAllBtn = document.getElementById('deselectAllBtn');
            const invertSelectionBtn = document.getElementById('invertSelectionBtn');
            const saveSettingsBtn = document.getElementById('saveSettingsBtn');
            const cancelSettingsBtn = document.getElementById('cancelSettingsBtn');
            
            // 初始化变量
            let options = [];
            let selectedOptions = [];
            let isDrawing = false;
            let drawInterval;
            let currentIndex = -1;
            // 用于临时存储设置中的选中状态
            let tempSelectedOptions = [];
            
            // 从本地存储加载数据
            function loadFromLocalStorage() {
                const savedData = localStorage.getItem('drawToolData');
                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        options = data.options || [];
                        selectedOptions = data.selectedOptions || [];
                        currentIndex = data.currentIndex || -1;
                        currentResult.textContent = currentIndex !== -1 ? currentIndex : '-';
                        return true;
                    } catch (e) {
                        console.error('Failed to parse saved data:', e);
                        return false;
                    }
                }
                return false;
            }
            
            // 保存数据到本地存储
            function saveToLocalStorage() {
                const data = {
                    options: options,
                    selectedOptions: selectedOptions,
                    currentIndex: currentIndex
                };
                localStorage.setItem('drawToolData', JSON.stringify(data));
            }
            
            // 清除本地存储数据
            function clearLocalStorage() {
                localStorage.removeItem('drawToolData');
            }
            
            // 初始化数字显示
            function initNumbers() {
                numbersContainer.innerHTML = '';
                for (let i = 1; i <= 20; i++) {
                    const numberElement = document.createElement('div');
                    numberElement.className = 'number';
                    numberElement.textContent = i;
                    numberElement.dataset.index = i;
                    // 点击数字可直接切换选中状态
                    numberElement.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        if (index <= options.length) {
                            toggleOptionSelection(index);
                        }
                    });
                    numbersContainer.appendChild(numberElement);
                }
                updateCounter();
            }
            
            // 更新计数器
            function updateCounter() {
                const total = options.length;
                const selected = selectedOptions.length;
                const remaining = total - selected;
                counter.textContent = `总选项: ${total} | 已选: ${selected} | 剩余: ${remaining}`;
            }
            
            // 更新数字状态
            function updateNumberStates() {
                const numberElements = document.querySelectorAll('.number');
                numberElements.forEach(el => {
                    const index = parseInt(el.dataset.index);
                    if (index <= options.length) {
                        el.style.display = 'flex';
                        if (selectedOptions.includes(index)) {
                            el.classList.add('selected');
                        } else {
                            el.classList.remove('selected');
                        }
                    } else {
                        el.style.display = 'none';
                    }
                });
            }
            
            // 切换单个选项的选中状态
            function toggleOptionSelection(index) {
                if (selectedOptions.includes(index)) {
                    selectedOptions = selectedOptions.filter(item => item !== index);
                } else {
                    selectedOptions.push(index);
                }
                updateNumberStates();
                updateCounter();
                saveToLocalStorage();
                status.textContent = `已更新选项 ${index} 状态`;
            }
            
            // 开始/停止抽签
            function toggleDrawing() {
                if (options.length === 0) {
                    status.textContent = '请先输入选项内容';
                    return;
                }
                
                if (selectedOptions.length >= options.length) {
                    status.textContent = '所有选项已抽完，请重置';
                    return;
                }
                
                if (!isDrawing) {
                    // 开始抽签
                    isDrawing = true;
                    drawBtn.textContent = '停止抽签';
                    drawBtn.classList.add('btn-stop');
                    status.textContent = '抽签中...';
                    currentResult.classList.add('pulse');
                    
                    // 获取未选中的选项
                    const availableOptions = [];
                    for (let i = 1; i <= options.length; i++) {
                        if (!selectedOptions.includes(i)) {
                            availableOptions.push(i);
                        }
                    }
                    
                    drawInterval = setInterval(() => {
                        // 随机选择一个未选中的选项
                        const randomIndex = Math.floor(Math.random() * availableOptions.length);
                        currentIndex = availableOptions[randomIndex];
                        currentResult.textContent = currentIndex;
                    }, 50);
                } else {
                    // 停止抽签
                    clearInterval(drawInterval);
                    isDrawing = false;
                    
                    // 记录选中的选项
                    selectedOptions.push(currentIndex);
                    
                    // 更新数字状态
                    updateNumberStates();
                    updateCounter();
                    
                    // 保存状态到本地存储
                    saveToLocalStorage();
                    
                    // 显示结果对话框
                    showResultModal();
                    
                    // 检查是否所有选项都已选中
                    if (selectedOptions.length >= options.length) {
                        status.textContent = '所有选项已抽完';
                    } else {
                        status.textContent = '抽签已停止，请查看结果';
                    }
                    
                    // 重置按钮状态
                    resetDrawButton();
                }
            }
            
            // 重置抽签按钮状态
            function resetDrawButton() {
                drawBtn.textContent = '开始抽签';
                drawBtn.classList.remove('btn-stop');
                currentResult.classList.remove('pulse');
            }
            
            // 显示结果对话框
            function showResultModal() {
                resultNumber.textContent = currentIndex;
                resultText.textContent = options[currentIndex - 1];
                resultModal.style.display = 'flex';
            }
            
            // 重置抽签
            function resetDrawing() {
                clearInterval(drawInterval);
                isDrawing = false;
                selectedOptions = [];
                currentIndex = -1;
                currentResult.textContent = '-';
                status.textContent = '已重置，准备开始抽签';
                currentResult.classList.remove('pulse');
                updateNumberStates();
                updateCounter();
                resetDrawButton();
                
                // 清除本地存储
                clearLocalStorage();
            }
            
            // 打开输入对话框
            function openInputModal() {
                inputModal.style.display = 'flex';
                optionsInput.value = options.map((opt, index) => `${index + 1}. ${opt}`).join('\n').replace(/\d+\.\s/g, '');
                updateLineCount();
            }
            
            // 关闭输入对话框
            function closeInputModal() {
                inputModal.style.display = 'none';
            }
            
            // 确认输入
            function confirmInput() {
                const inputText = optionsInput.value.trim();
                if (inputText) {
                    // 按行分割，过滤空行，限制最多20个
                    options = inputText.split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0)
                        .slice(0, 20);
                    
                    // 重置抽签状态
                    selectedOptions = [];
                    currentIndex = -1;
                    currentResult.textContent = '-';
                    resetDrawButton();
                    updateNumberStates();
                    updateCounter();
                    
                    // 保存选项到本地存储
                    saveToLocalStorage();
                    
                    status.textContent = `已输入 ${options.length} 个选项`;
                    closeInputModal();
                } else {
                    status.textContent = '请输入至少一个选项';
                }
            }
            
            // 更新行数计数
            function updateLineCount() {
                const lines = optionsInput.value.split('\n').filter(line => line.trim().length > 0).length;
                lineCount.textContent = Math.min(lines, 20);
            }
            
            // 打开设置对话框
            function openSettingsModal() {
                if (options.length === 0) {
                    status.textContent = '请先输入选项内容';
                    return;
                }
                
                // 初始化临时选中状态
                tempSelectedOptions = [...selectedOptions];
                
                // 生成设置选项
                settingsOptionsContainer.innerHTML = '';
                options.forEach((option, index) => {
                    const optionIndex = index + 1;
                    const settingsOption = document.createElement('div');
                    settingsOption.className = 'settings-option';
                    
                    settingsOption.innerHTML = `
                        <input type="checkbox" id="setting-option-${optionIndex}" value="${optionIndex}" ${tempSelectedOptions.includes(optionIndex) ? 'checked' : ''}>
                        <label for="setting-option-${optionIndex}">
                            <span class="option-number">${optionIndex}.</span>
                            <span class="option-text">${option}</span>
                        </label>
                    `;
                    
                    settingsOptionsContainer.appendChild(settingsOption);
                    
                    // 绑定复选框事件
                    const checkbox = settingsOption.querySelector('input[type="checkbox"]');
                    checkbox.addEventListener('change', function() {
                        const value = parseInt(this.value);
                        if (this.checked) {
                            if (!tempSelectedOptions.includes(value)) {
                                tempSelectedOptions.push(value);
                            }
                        } else {
                            tempSelectedOptions = tempSelectedOptions.filter(item => item !== value);
                        }
                    });
                });
                
                settingsModal.style.display = 'flex';
            }
            
            // 关闭设置对话框
            function closeSettingsModal() {
                settingsModal.style.display = 'none';
            }
            
            // 全选
            function selectAllOptions() {
                tempSelectedOptions = [];
                for (let i = 1; i <= options.length; i++) {
                    tempSelectedOptions.push(i);
                }
                updateSettingsCheckboxes();
            }
            
            // 全不选
            function deselectAllOptions() {
                tempSelectedOptions = [];
                updateSettingsCheckboxes();
            }
            
            // 反选
            function invertSelection() {
                const allOptions = [];
                for (let i = 1; i <= options.length; i++) {
                    allOptions.push(i);
                }
                
                tempSelectedOptions = allOptions.filter(option => !selectedOptions.includes(option));
                updateSettingsCheckboxes();
            }
            
            // 更新设置对话框中的复选框状态
            function updateSettingsCheckboxes() {
                const checkboxes = settingsOptionsContainer.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    const value = parseInt(checkbox.value);
                    checkbox.checked = tempSelectedOptions.includes(value);
                });
            }
            
            // 保存设置
            function saveSettings() {
                selectedOptions = [...tempSelectedOptions];
                updateNumberStates();
                updateCounter();
                saveToLocalStorage();
                status.textContent = '选项状态设置已保存';
                closeSettingsModal();
            }
            
            // 事件监听
            inputBtn.addEventListener('click', openInputModal);
            drawBtn.addEventListener('click', toggleDrawing);
            resetBtn.addEventListener('click', resetDrawing);
            settingsBtn.addEventListener('click', openSettingsModal);
            confirmBtn.addEventListener('click', confirmInput);
            cancelBtn.addEventListener('click', closeInputModal);
            optionsInput.addEventListener('input', updateLineCount);
            closeResultBtn.addEventListener('click', function() {
                resultModal.style.display = 'none';
            });
            selectAllBtn.addEventListener('click', selectAllOptions);
            deselectAllBtn.addEventListener('click', deselectAllOptions);
            invertSelectionBtn.addEventListener('click', invertSelection);
            saveSettingsBtn.addEventListener('click', saveSettings);
            cancelSettingsBtn.addEventListener('click', closeSettingsModal);
            
            // 初始化
            initNumbers();
            
            // 尝试从本地存储加载数据
            const loaded = loadFromLocalStorage();
            if (loaded) {
                updateNumberStates();
                updateCounter();
                if (options.length > 0) {
                    status.textContent = `已加载保存的抽签数据 (${options.length}个选项)`;
                }
            }
        });
    </script>
</body>
</html>
