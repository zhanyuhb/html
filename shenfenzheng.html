<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>身份证校验位计算器</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #2d3748;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .glassmorphism {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px 0 rgba(31, 38, 135, 0.2);
        }

        .blob {
            position: absolute;
            background: linear-gradient(135deg, #4299e1 0%, #9f7aea 100%);
            filter: blur(60px);
            opacity: 0.3;
            border-radius: 50%;
            animation: blob-movement 15s infinite linear;
            z-index: -2;
        }

        @keyframes blob-movement {
            0% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(5%, -10%) scale(1.3); }
            66% { transform: translate(-15%, 5%) scale(0.9); }
            100% { transform: translate(0, 0) scale(1); }
        }

        .highlight-text {
            position: relative;
            display: inline-block;
        }

        .highlight-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background-color: rgba(99, 102, 241, 0.2);
            z-index: -1;
        }

        .bg-gradient-primary {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        }

        .shadow-glow {
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.5);
        }

        .input-focus {
            transition: all 0.3s ease;
        }

        .input-focus:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            outline: none;
        }

        .btn-primary {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border: none;
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.5);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .result-card {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .result-card.show {
            opacity: 1;
            transform: translateY(0);
        }

        .form-step {
            position: relative;
            transition: all 0.3s ease;
        }

        .form-step::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -20px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #4f46e5;
            transform: translateY(-50%);
        }

        .form-step::after {
            content: '';
            position: absolute;
            top: 50%;
            left: -15px;
            width: 2px;
            height: 100%;
            background-color: #e5e7eb;
            transform: translateY(-50%);
            z-index: -1;
        }

        .form-step:last-child::after {
            display: none;
        }

        footer {
            margin-top: auto;
            padding: 1rem 0;
            text-align: center;
            color: #6b7280;
            font-size: 0.875rem;
        }

        /* 折叠面板样式 */
        .collapsible {
            background-color: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            margin-top: 12px;
            overflow: hidden;
        }

        .collapsible-header {
            padding: 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .collapsible-header:hover {
            background-color: #f1f5f9;
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .collapsible-content-inner {
            padding: 0 16px 16px;
        }

        .collapsible.active .collapsible-content {
            max-height: 1000px;
        }

        .collapsible-icon {
            transition: transform 0.3s ease;
        }

        .collapsible.active .collapsible-icon {
            transform: rotate(180deg);
        }

        /* 计算步骤样式 */
        .calculation-step {
            margin-bottom: 12px;
            padding: 12px;
            background-color: #ffffff;
            border-radius: 8px;
            border-left: 4px solid #4f46e5;
        }

        .calculation-step:last-child {
            margin-bottom: 0;
        }

        .step-details {
            font-family: 'Courier New', monospace;
            background-color: #f8fafc;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            word-break: break-all;
        }
        
        .multiplication-steps {
            list-style-type: decimal;
            list-style-position: inside;
            padding-left: 8px;
        }
        
        .multiplication-steps li {
            margin-bottom: 4px;
        }
        
        .multiplication-steps li:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="blob w-96 h-96 top-0 left-0"></div>
    <div class="blob w-80 h-80 bottom-0 right-0"></div>

    <div class="container mx-auto px-4 py-16 max-w-4xl">
        <!-- 头部标题 -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-transparent bg-clip-text">
                身份证校验位计算器
            </h1>
            <p class="text-gray-600 max-w-2xl mx-auto">
                输入身份证号码前17位，我们将根据国家标准算法为您计算第18位校验码
            </p>
        </header>

        <!-- 主要内容区域 -->
        <main class="glassmorphism p-8 md:p-12 card-hover">
            <!-- 计算表单 -->
            <div class="mb-10">
                <div class="form-step mb-6">
                    <label for="idCardNumber" class="block text-gray-700 font-medium mb-2">请输入身份证号码前17位</label>
                    <input 
                        type="text" 
                        id="idCardNumber" 
                        class="w-full px-4 py-3 rounded-lg border border-gray-300 input-focus" 
                        placeholder="例如：11010119900101123"
                        maxlength="17"
                        inputmode="numeric"
                        pattern="\d{17}"
                    >
                    <p id="inputError" class="mt-2 text-red-500 text-sm hidden">请输入17位数字</p>
                </div>

                <div class="form-step">
                    <button 
                        id="calculateBtn" 
                        class="w-full py-3 px-6 rounded-lg btn-primary font-medium text-white shadow-glow flex items-center justify-center"
                    >
                        <i class="fas fa-calculator mr-2"></i> 计算校验位
                    </button>
                </div>
            </div>

            <!-- 结果显示区域 -->
            <div id="resultArea" class="result-card mt-8 p-6 bg-indigo-50 rounded-lg border border-indigo-100">
                <h2 class="text-xl font-semibold mb-4 text-indigo-700 flex items-center">
                    <i class="fas fa-check-circle mr-2"></i> 计算结果
                </h2>
                <div class="mb-4">
                    <p class="text-gray-600 mb-1">前17位数字：</p>
                    <p id="inputDigits" class="font-mono text-lg bg-white p-2 rounded"></p>
                </div>
                <div class="mb-4">
                    <p class="text-gray-600 mb-1">校验位：</p>
                    <p id="checkDigit" class="font-mono text-3xl font-bold text-indigo-600 bg-white p-3 rounded inline-block shadow-glow"></p>
                </div>
                <div>
                    <p class="text-gray-600 mb-1">完整身份证号码：</p>
                    <p id="fullIdCard" class="font-mono text-lg bg-white p-2 rounded"></p>
                </div>
            </div>

            <!-- 计算步骤折叠面板 -->
            <div id="calculationSteps" class="collapsible mt-8">
                <div class="collapsible-header">
                    <h2 class="text-xl font-semibold text-indigo-700 flex items-center">
                        <i class="fas fa-step-forward mr-2"></i> 计算步骤
                    </h2>
                    <i class="fas fa-chevron-down collapsible-icon text-indigo-500"></i>
                </div>
                <div class="collapsible-content">
                    <div class="collapsible-content-inner">
                        <ol id="stepsList" class="space-y-4">
                            <!-- 计算步骤将通过JavaScript动态生成 -->
                        </ol>
                    </div>
                </div>
            </div>

            <!-- 计算原理说明 -->
            <div class="mt-12 p-6 bg-blue-50 rounded-lg border border-blue-100">
                <h2 class="text-xl font-semibold mb-4 text-blue-700 flex items-center">
                    <i class="fas fa-info-circle mr-2"></i> 校验位计算原理
                </h2>
                <p class="text-gray-600 mb-4">
                    身份证号码的第18位校验码是根据前17位数字，按照ISO 7064:1983.MOD 11-2校验码计算方法计算得出的。
                </p>
                <ol class="list-decimal list-inside text-gray-600 space-y-2">
                    <li>将前17位数字分别乘以不同的系数：7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2</li>
                    <li>将所有乘积相加得到总和</li>
                    <li>用总和除以11，得到余数</li>
                    <li>根据余数查找对应的校验码：0-10，其中10用X表示</li>
                </ol>
            </div>
        </main>
    </div>

    <!-- 页脚 -->
    <footer>
        <p>created by <a href="https://space.coze.cn" class="text-indigo-600 hover:underline">coze space</a></p>
        <p>页面内容均由 AI 生成，仅供参考</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const idCardInput = document.getElementById('idCardNumber');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultArea = document.getElementById('resultArea');
            const inputError = document.getElementById('inputError');
            const inputDigits = document.getElementById('inputDigits');
            const checkDigit = document.getElementById('checkDigit');
            const fullIdCard = document.getElementById('fullIdCard');
            const calculationSteps = document.getElementById('calculationSteps');
            const stepsList = document.getElementById('stepsList');

            // 初始化时隐藏结果区域和计算步骤
            resultArea.classList.remove('show');
            calculationSteps.classList.remove('active');

            // 折叠面板点击事件
            calculationSteps.querySelector('.collapsible-header').addEventListener('click', function() {
                calculationSteps.classList.toggle('active');
            });

            // 计算按钮点击事件
            calculateBtn.addEventListener('click', function() {
                const inputValue = idCardInput.value.trim();
                
                // 验证输入
                if (!/^\d{17}$/.test(inputValue)) {
                    inputError.classList.remove('hidden');
                    resultArea.classList.remove('show');
                    calculationSteps.classList.remove('active');
                    return;
                }
                
                // 隐藏错误提示
                inputError.classList.add('hidden');
                
                // 计算校验位并获取计算步骤
                const { digit, steps } = calculateCheckDigitWithSteps(inputValue);
                
                // 显示结果
                inputDigits.textContent = inputValue;
                checkDigit.textContent = digit;
                fullIdCard.textContent = inputValue + digit;
                
                // 显示结果区域并添加动画
                setTimeout(() => {
                    resultArea.classList.add('show');
                    
                    // 生成并显示计算步骤
                    generateCalculationSteps(steps);
                    
                    // 展开计算步骤面板
                    calculationSteps.classList.add('active');
                    
                    // 滚动到结果区域
                    resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            });

            // 输入框事件监听
            idCardInput.addEventListener('input', function() {
                // 只允许输入数字
                this.value = this.value.replace(/\D/g, '');
                
                // 如果有错误提示，当输入变化时隐藏
                if (!inputError.classList.contains('hidden')) {
                    inputError.classList.add('hidden');
                }
            });

            // 生成计算步骤HTML
            function generateCalculationSteps(steps) {
                stepsList.innerHTML = '';
                
                // 步骤1：系数相乘过程 - 修改为17行单独计算
                const step1 = document.createElement('li');
                step1.className = 'calculation-step';
                
                // 创建步骤标题
                const step1Title = document.createElement('div');
                step1Title.className = 'font-medium';
                step1Title.textContent = '1. 将前17位数字分别乘以不同的系数';
                step1.appendChild(step1Title);
                
                // 创建步骤详情容器
                const step1Details = document.createElement('div');
                step1Details.className = 'step-details';
                
                // 创建乘法步骤列表
                const multiplicationList = document.createElement('ol');
                multiplicationList.className = 'multiplication-steps';
                
                // 为每一位数字创建单独的计算步骤
                for (let i = 0; i < steps.multiplication.length; i++) {
                    const listItem = document.createElement('li');
                    
                    // 解析乘法步骤字符串
                    const parts = steps.multiplication[i].split(' × ');
                    const digit = parts[0];
                    const factorAndProduct = parts[1].split(' = ');
                    const factor = factorAndProduct[0];
                    const product = factorAndProduct[1];
                    
                    // 格式化并加粗数字
                    listItem.innerHTML = `第${i+1}位：<strong>${digit}</strong> × <strong>${factor}</strong> = <strong>${product}</strong>`;
                    multiplicationList.appendChild(listItem);
                }
                
                step1Details.appendChild(multiplicationList);
                step1.appendChild(step1Details);
                stepsList.appendChild(step1);
                
                // 步骤2：总和结果
                const step2 = document.createElement('li');
                step2.className = 'calculation-step';
                step2.innerHTML = `
                    <div class="font-medium">2. 将所有乘积相加得到总和</div>
                    <div class="step-details">
                        总和 = <strong>${steps.sum}</strong>
                    </div>
                `;
                stepsList.appendChild(step2);
                
                // 步骤3：取余运算
                const step3 = document.createElement('li');
                step3.className = 'calculation-step';
                step3.innerHTML = `
                    <div class="font-medium">3. 用总和除以11，得到余数</div>
                    <div class="step-details">
                        ${steps.sum} ÷ 11 = ${Math.floor(steps.sum / 11)} 余 <strong>${steps.remainder}</strong>
                    </div>
                `;
                stepsList.appendChild(step3);
                
                // 步骤4：校验码映射
                const step4 = document.createElement('li');
                step4.className = 'calculation-step';
                step4.innerHTML = `
                    <div class="font-medium">4. 根据余数查找对应的校验码</div>
                    <div class="step-details">
                        校验码对应表：[1, 0, X, 9, 8, 7, 6, 5, 4, 3, 2]<br>
                        余数 ${steps.remainder} 对应的校验码：<strong>${steps.checkDigit}</strong>
                    </div>
                `;
                stepsList.appendChild(step4);
            }

            // 身份证校验位计算函数（带步骤）
            function calculateCheckDigitWithSteps(idCard17) {
                // 加权因子
                const factors = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
                // 校验码对应表
                const checkCodes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
                
                // 计算乘法步骤
                const multiplication = [];
                let sum = 0;
                
                for (let i = 0; i < 17; i++) {
                    const digit = parseInt(idCard17.charAt(i));
                    const factor = factors[i];
                    const product = digit * factor;
                    multiplication.push(`${digit} × ${factor} = ${product}`);
                    sum += product;
                }
                
                // 计算余数并返回对应的校验码
                const remainder = sum % 11;
                const checkDigit = checkCodes[remainder];
                
                // 返回结果和计算步骤
                return {
                    digit: checkDigit,
                    steps: {
                        multiplication,
                        sum,
                        remainder,
                        checkDigit
                    }
                };
            }
        });
    </script>
</body>
</html>
